<!DOCTYPE html>
<html lang="en">
  <head>
    <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>The Book of Bitcoin</title>
  </head>
  <body>
    <header class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header"><a class="navbar-brand" href="../../index.html"><i class="fa fa-bookmark"></i><span>&#160;The Book of Bitcoin</span></a></div>
      </div>
    </header>
    <div class="container" id="article">
      <div class="row">
        <div class="col-md-8">
          <div class="content"><h1 id="forks">Forks</h1>
<h2 id="hard-fork">Hard Fork</h2>
<p>Any change to the Bitcoin protocol that means the existing nodes would reject blocks and transactions as invalid is called a <em>hard forking</em> change.</p>
<p>Since the Bitcoin protocol is strict about setting limits in a wide variety of areas, most notably the coin limit and block size limit, there are a wide number of changes that may appear to be simple, but from from a protocol perspective are equivalent to completely changing the entire system.</p>
<p>Not all clients of the Bitcoin protocol work the same way. It&#39;s possible to change the limits, and so for some types of clients, a hard fork would not be a hard fork at all. Because this is confusing, generally only the broad consensus of the Bitcoin rules is considered when referring to a hard fork.</p>
<h3 id="proposed-hard-forks">Proposed Hard Forks</h3>
<p>It&#39;s generally understood that should there be an obvious issue or critical problem with the Blockchain, any issue including a deliberate attack on the network, this problem can be solved with a rapid, dynamically chosen or custom developed hard fork.</p>
<p>Satoshi Nakamoto once proposed that in the future a possible hard fork to increase the block size limit be implemented by using a far future <em>flag day</em>, a day after which the old ruleset is no longer used and a new ruleset is switched to.</p>
<p>One Bitcoin protocol change that has been long discussed is the reversal of how Bitcoin transactions are confirmed. In the existing protocol, miners sweep unconfirmed transactions into their blocks. In a theorized change, miners would win a temporary period of time in which they could simply directly add transactions to the Blockchain. </p>
<p>Every Bitcoin can be subdivided into one hundred million Satoshis, however this may not always be enough. A hard fork could increase the divisibility without increasing the coin limit, should the value of a Satoshi grow by enough to justify the change.</p>
<h2 id="accidental-hard-forks">Accidental Hard Forks</h2>
<p>Sometimes a hard fork happens in an unplanned way, where miners simply make invalid blocks for accidental reasons.</p>
<p>In July of 2015, this happened on two separate occasions. The first fork produced a series of six invalid blocks, starting with an invalid block from the small mining pool <em>BTC Nuggets</em>, and then followed by a series of five blocks produced by the Chinese mining pools <em>AntPool</em> and <em>F2Pool</em>. The next day, a similar fork occurred, initiated by a block created by the miner <em>MegaBigPower</em>. The block was followed by two invalid blocks created by unknown miners.</p>
<p>The reason for this fork is that from the point of view of the network, some miners attempted to reverse the rules set up in the <a href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki">BIP 66</a> soft fork upgrade. This split the network into two: Bitcoin nodes that used the consensus rule set defined in Bitcoin version 0.9.4 and Bitcoin nodes that used the consensus rule set defined in Bitcoin version 0.9.5.</p>
<h2 id="soft-fork">Soft Fork</h2>
<p>Any change to the Bitcoin protocol&#39;s consensus rules that is more restrictive than the existing set of rules is called a <em>soft fork</em>. Generally soft forks are considered backwards-compatible because nodes on both sides of the consensus fork may remain interoperable. The standard rollout of a soft fork involves a majority of mining hashing power updating node software to only mine transactions that comply with soft fork rules, and deliberately avoid building on blocks who do not do the same.</p>
<p>Reversing a soft fork would be changing the limits to something that existing nodes would reject, and is thus a hard fork. The hard fork would be from the point of view of the updated nodes only, older nodes would not notice the reversal. This means that even a majority of miners enforcing a soft fork at one point in time do not provide an assurance that the soft fork will remain or be constantly enforced. The assurance derives from the rest of the network&#39;s acceptance of the soft fork code, which provides the hard fork cost to the miner of rolling back the soft fork.</p>
<p>Soft fork rollbacks may be accidental, shepherding the miners and the network to a new set of consensus rules can be a perilous process and has led to multiple historical accidents. To safeguard against this, steps have been taken to encourage miners to accurately signal their soft fork consensus rules in BIP 9, and the common process for miners coming to agreement on a soft fork is to signal for three to four weeks that the soft fork has at least ninety-five percent consensus and will be enforced permanently. A soft fork increases the risk to an out of date node that they will no longer be following consensus, so they are encouraged to either update their node to the soft fork or reduce their payment receipt risk by waiting for more confirmations.</p>
<h3 id="adding-features">Adding Features</h3>
<p>The primary method of adding major features to the Bitcoin protocol is to use a soft fork to enforce new rules about a transaction. For example: adding a new transaction type that appeared to spend funds that anyone might be able to spend but also included a script that others would validate as only being spendable under arbitrary conditions. This transaction would pass muster both to nodes that could not validate the new unknown conditions and to nodes that could validate the script&#39;s additional requirements. In this way, miners introduce new spending types by enforcing new rules on apparently less-restricted transactions.</p>
<p>In the case of the P2SH soft fork which enabled new transaction types such as multi signature transactions, the signature requirement to spend funds locked in a P2SH address simply changed to be more restrictive. Before P2SH, anyone could spend funds sent to an output script that matched the pattern <em>OP_HASH160 $value OP_EQUAL</em> as long as they provided an input that matched the hash value. After P2SH only the value that matched a working script could be used to spend funds.</p>
<p>Many transaction operation codes or <em>opcodes</em> have been with Bitcoin since the early days of the protocol. This set of codes also includes codes that do nothing and always validate, so that in the future they may be used to include new features as they are conceived and agreed upon, without the need to hard fork.</p>
<h3 id="fixing-issues">Fixing Issues</h3>
<p>Sometimes a soft fork is necessary to correct a bug. This deployment strategy leaves the bug present in older versions, but takes advantage of the majority miners to censor transactions that exhibit a bug from the Blockchain.</p>
<p>In <a href="https://bitcointalk.org/index.php?topic=822.0">August of 2010</a>, a block was mined with a spurious transaction that created a chain with a transaction sending over a hundred billion bitcoins, an amount that had no source but was rather the result of a coding error called a <em>value overflow</em>, where values were not properly checked for numbers that could not be accurately stored.</p>
<p>The severity of the issue was somewhat muted, at that time the project was yet to find popularity and the value of the entire market hovered around hundreds of thousands of dollars. Nevertheless, the obviousness of the problem dictated that a solution be found, and Satoshi Nakamoto <a href="https://bitcointalk.org/index.php?topic=823.msg9548#msg9548">published a comprehensive fix</a> within four hours of the problem&#39;s discovery. The fix had quick uptake that reorganized the chain around the offending transaction within an hour, striking it from the Blockchain history, and preventing any future similar inclusion by miners.</p>
</div>
        </div>
        <div class="col-md-4">
          <nav class="navbar navbar-default">
            <div class="container-fluid">
              <div class="navbar-header"><a class="btn btn-default navbar-btn" href="https://github.com/thebookofbitcoin/thebookofbitcoin.github.io/edit/master/content/network/forks.md"><i class="fa fa-github">&#160;</i><span>Edit</span></a>
                <p class="navbar-right navbar-text"><span>Text licensed </span><a class="navbar-link" href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank">CC0</a></p>
              </div>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </body>
</html>